<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.</declaration>
	<template>
		<name x="5" y="5">MajorRoad</name>
		<parameter>broadcast chan &amp;trigger, broadcast chan &amp;timed, chan &amp;flip, bool &amp;changed, broadcast chan &amp;finish, bool &amp;toGreen</parameter>
		<declaration>// Place local declarations here.
clock x;</declaration>
		<location id="id0" x="-782" y="-204">
			<name x="-792" y="-238">green</name>
		</location>
		<location id="id1" x="289" y="-246">
			<name x="279" y="-280">red</name>
		</location>
		<location id="id2" x="-408" y="76">
			<name x="-418" y="42">yellow</name>
			<label kind="invariant" x="-418" y="93">x &lt;= 5</label>
		</location>
		<location id="id3" x="-221" y="76">
			<name x="-255" y="93">changing</name>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="guard" x="-390" y="-85">toGreen &amp;&amp; changed</label>
			<label kind="synchronisation" x="-390" y="-68">finish?</label>
			<nail x="-408" y="-178"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="76" y="-297">flip?</label>
			<label kind="assignment" x="-76" y="-280">toGreen = true</label>
			<nail x="50" y="-268"/>
			<nail x="-94" y="-166"/>
			<nail x="-162" y="-64"/>
			<nail x="-196" y="29"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id1"/>
			<label kind="guard" x="161" y="-229">changed</label>
			<label kind="synchronisation" x="119" y="-187">flip?</label>
			<label kind="assignment" x="110" y="-127">x = 0, changed = false</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id3"/>
			<label kind="guard" x="-748" y="-136">x &gt;= 30</label>
			<label kind="synchronisation" x="-714" y="-195">trigger?</label>
			<label kind="assignment" x="-731" y="-119">x = 0, toGreen = false</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-347" y="144">flip?</label>
			<label kind="assignment" x="-347" y="161">x = 0</label>
			<nail x="-442" y="110"/>
			<nail x="-425" y="144"/>
			<nail x="-365" y="161"/>
			<nail x="-263" y="161"/>
			<nail x="-195" y="144"/>
			<nail x="-170" y="118"/>
			<nail x="-170" y="84"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="guard" x="-356" y="51">x == 1 &amp;&amp; !changed</label>
			<label kind="synchronisation" x="-339" y="84">flip?</label>
			<label kind="assignment" x="-374" y="110">changed = true, x = 0</label>
		</transition>
	</template>
	<template>
		<name>MinorRoad</name>
		<parameter>broadcast chan &amp;trigger, broadcast chan &amp;timed, chan &amp;flip, bool &amp;changed, broadcast chan &amp;finish, bool &amp;toRed</parameter>
		<declaration>clock y;</declaration>
		<location id="id4" x="-799" y="-187">
			<name x="-809" y="-221">green</name>
			<label kind="invariant" x="-809" y="-170">y &lt;= 30</label>
		</location>
		<location id="id5" x="255" y="-170">
			<name x="245" y="-204">red</name>
		</location>
		<location id="id6" x="-246" y="-153">
			<name x="-280" y="-136">changing</name>
		</location>
		<location id="id7" x="-433" y="-153">
			<name x="-441" y="-195">yellow</name>
			<label kind="invariant" x="-443" y="-136">y &lt;= 5</label>
		</location>
		<init ref="id5"/>
		<transition>
			<source ref="id6"/>
			<target ref="id5"/>
			<label kind="guard" x="-25" y="-255">toRed &amp;&amp; changed</label>
			<label kind="synchronisation" x="-34" y="-221">finish!</label>
			<nail x="-110" y="-221"/>
			<nail x="-25" y="-229"/>
			<nail x="127" y="-221"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-789" y="-331">flip!</label>
			<label kind="assignment" x="-789" y="-314">toRed = true</label>
			<nail x="-850" y="-272"/>
			<nail x="-807" y="-306"/>
			<nail x="-688" y="-323"/>
			<nail x="-501" y="-331"/>
			<nail x="-365" y="-331"/>
			<nail x="-221" y="-306"/>
			<nail x="-187" y="-238"/>
			<nail x="-212" y="-195"/>
			<nail x="-229" y="-170"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id4"/>
			<label kind="guard" x="-748" y="-272">changed &amp;&amp; !toRed</label>
			<label kind="synchronisation" x="-663" y="-297">flip!</label>
			<label kind="assignment" x="-731" y="-221">y = 0, changed = false</label>
			<nail x="-348" y="-255"/>
			<nail x="-467" y="-280"/>
			<nail x="-654" y="-272"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-372" y="-85">flip!</label>
			<label kind="assignment" x="-372" y="-68">y = 0</label>
			<nail x="-467" y="-119"/>
			<nail x="-450" y="-85"/>
			<nail x="-390" y="-68"/>
			<nail x="-288" y="-68"/>
			<nail x="-220" y="-85"/>
			<nail x="-195" y="-111"/>
			<nail x="-195" y="-145"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="guard" x="-381" y="-178">y == 1 &amp;&amp; !changed</label>
			<label kind="synchronisation" x="-364" y="-145">flip!</label>
			<label kind="assignment" x="-399" y="-119">changed = true, y = 0</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="187" y="-110">trigger?</label>
			<label kind="assignment" x="153" y="-144">y = 0, toRed = false</label>
		</transition>
	</template>
	<template>
		<name>Sensor</name>
		<parameter>broadcast chan &amp;trigger, broadcast chan &amp;timed, broadcast chan &amp;finish</parameter>
		<declaration>clock z;</declaration>
		<location id="id8" x="-255" y="85">
		</location>
		<location id="id9" x="-467" y="68">
			<name x="-476" y="34">wait</name>
		</location>
		<location id="id10" x="-357" y="-42">
			<name x="-367" y="-76">disabled</name>
		</location>
		<init ref="id8"/>
		<transition>
			<source ref="id10"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="-339" y="4">finish?</label>
			<label kind="assignment" x="-339" y="21">z = 0</label>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="guard" x="-459" y="-17">z &gt;= 30</label>
			<label kind="synchronisation" x="-425" y="34">trigger!</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
			<nail x="-323" y="110"/>
			<nail x="-365" y="119"/>
			<nail x="-433" y="110"/>
		</transition>
	</template>
	<system>bool changed1, changed2, toRed, toGreen;
broadcast chan trigger, timed, finish;
chan flip;

// Place template instantiations here.
Sensor1 = Sensor(trigger, timed, finish);
Sem1 = MajorRoad(trigger, timed, flip, changed1, finish, toGreen);
Sem2 = MinorRoad(trigger, timed, flip, changed2, finish, toRed);

// List one or more processes to be composed into a system.
system Sensor1, Sem1, Sem2;
    </system>
	<queries>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
	</queries>
</nta>
